<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI 챗봇 | 센터 입력형</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --ink:#0f172a;         /* 본문 텍스트 */
      --muted:#64748b;       /* 보조 텍스트 */
      --line:#e2e8f0;        /* 라인/테두리 */
      --bg:#ffffff;          /* 배경 */
      --panel:#f8fafc;       /* 패널 배경 */
      --brand:#4f46e5;       /* 브랜드 포인트 */
      --ok:#10b981;          /* 음성 녹음 on */
    }
    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0; font-family:'Pretendard',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Apple SD Gothic Neo','Noto Sans KR',sans-serif;
      color:var(--ink); background:var(--bg);
      display:flex; align-items:center; justify-content:center;
    }
    .shell{ width:min(900px,92vw); text-align:center; }
    .title{ font-weight:700; font-size:clamp(20px,3.6vw,28px); margin-bottom:22px; letter-spacing:-0.2px; }

    .askbar{ position:relative; display:flex; align-items:center; gap:10px; padding:14px 16px; border-radius:999px; border:1px solid var(--line); background:#fff; box-shadow:0 8px 30px rgba(2, 6, 23, 0.06); }
    .askbar:focus-within{ outline:2px solid color-mix(in oklab, var(--brand) 30%, white); }

    .prefix{ width:34px; height:34px; border-radius:999px; display:grid; place-items:center; border:1px solid var(--line); background:var(--panel); flex:0 0 auto; font-weight:600; color:var(--muted); }
    .input{ flex:1 1 auto; border:none; outline:none; font-size:16px; color:var(--ink); }
    .input::placeholder{ color:var(--muted); }

    .btn{ width:36px; height:36px; border:none; background:#fff; border-radius:999px; display:grid; place-items:center; cursor:pointer; border:1px solid var(--line); }
    .btn:active{ transform:translateY(1px); }
    .btn[data-on="true"]{ border-color:color-mix(in oklab, var(--ok) 60%, var(--line)); box-shadow:0 0 0 4px color-mix(in oklab, var(--ok) 18%, white); }

    .hint{ margin-top:12px; font-size:13px; color:var(--muted); }

    .result{ width:min(900px,92vw); margin:26px auto 0; text-align:left; background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:18px; display:none; }
    .res-head{ display:flex; align-items:center; gap:8px; font-weight:600; margin-bottom:8px; }
    .loader{ width:16px; height:16px; border-radius:999px; border:2px solid var(--brand); border-top-color:transparent; animation:spin 1s linear infinite; }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* 파형 아이콘(애니) */
    .wave{display:inline-flex; gap:2px; align-items:end;}
    .wave span{ width:3px; height:10px; background:var(--brand); border-radius:2px; animation: wv 1s ease-in-out infinite; }
    .wave span:nth-child(2){ animation-delay:.1s }
    .wave span:nth-child(3){ animation-delay:.2s }
    @keyframes wv{ 0%,100%{height:6px} 50%{height:14px} }

    /* 모바일 대응 */
    @media (max-width:480px){ .askbar{padding:12px 12px} .prefix{display:none} }
  </style>
</head>
<body>
  <main class="shell">
    <h1 class="title">무슨 작업을 하고 계세요?</h1>
    <div class="askbar" role="search">
      <div class="prefix" aria-hidden>+</div>
      <input id="q" class="input" placeholder="무엇이든 물어보세요" autocomplete="off" />
      <button id="mic" class="btn" title="음성 입력" aria-label="음성 입력">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden>
          <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 0 0-6 0v5a3 3 0 0 0 3 3Z" stroke="currentColor" stroke-width="1.5"/>
          <path d="M19 11a7 7 0 0 1-14 0" stroke="currentColor" stroke-width="1.5"/>
          <path d="M12 18v3" stroke="currentColor" stroke-width="1.5"/>
        </svg>
      </button>
      <button id="send" class="btn" title="질문 보내기" aria-label="질문 보내기">
        <div class="wave" aria-hidden><span></span><span></span><span></span></div>
      </button>
    </div>
    <p class="hint">Enter로 전송 · 마이크로 말하기 · 서버 연동은 <code>/api/chat</code> 엔드포인트를 수정하세요.</p>

    <section id="result" class="result" aria-live="polite" aria-busy="false">
      <div class="res-head">
        <div id="busy" class="loader" hidden></div>
        <div>GPT 분석 결과</div>
      </div>
      <div id="answer" class="res-body"></div>
    </section>
  </main>

  <script>
    // ====== 상태 ======
    const $q = document.getElementById('q');
    const $result = document.getElementById('result');
    const $answer = document.getElementById('answer');
    const $busy = document.getElementById('busy');
    const $send = document.getElementById('send');
    const $mic = document.getElementById('mic');

    // ====== 전송 함수 ======
    async function ask() {
      const text = $q.value.trim();
      if (!text) return;
      $result.style.display = 'block';
      $busy.hidden = false; $result.setAttribute('aria-busy','true');
      $answer.textContent = '';
      try {
        // 여기를 실제 백엔드로 교체하세요. (예: /api/chat)
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query: text })
        });
        if (!res.ok) throw new Error('응답 오류');
        const data = await res.json();
        // data.answer(텍스트) 또는 {type:..., items:[...]} 같은 구조화 응답을 지원
        $answer.innerHTML = (typeof data.answer === 'string') ?
          escapeHtml(data.answer).replace(/\n/g,'<br/>') :
          `<pre>${escapeHtml(JSON.stringify(data, null, 2))}</pre>`;
      } catch (e) {
        $answer.innerHTML = '<span style="color:#ef4444">답변 중 오류가 발생했어요. 서버 설정을 확인해주세요.</span>';
        console.error(e);
      } finally {
        $busy.hidden = true; $result.setAttribute('aria-busy','false');
      }
    }

    // ====== 이벤트 ======
    $send.addEventListener('click', ask);
    $q.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ ask(); }});

    // ====== 음성 입력(Web Speech API) ======
    let rec;
    if ('webkitSpeechRecognition' in window) {
      rec = new webkitSpeechRecognition();
      rec.lang = 'ko-KR';
      rec.interimResults = false; rec.maxAlternatives = 1;
      rec.onresult = (ev)=>{ const t = ev.results[0][0].transcript; $q.value = t; ask(); };
      rec.onerror = ()=> toggleMic(false);
    }
    function toggleMic(forceOff){
      if (!rec) { alert('이 브라우저는 음성 인식을 지원하지 않아요.'); return; }
      const on = $mic.dataset.on === 'true';
      const next = forceOff ? false : !on;
      $mic.dataset.on = String(next);
      if (next) rec.start(); else rec.stop();
    }
    $mic.addEventListener('click', ()=> toggleMic());

    // ====== 유틸 ======
    function escapeHtml(str){
      return str.replace(/[&<>"']/g, s=>({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'
      })[s]);
    }
  </script>
</body>
</html>
